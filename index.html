<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Configuration Tradi'home P4</title>

  <!-- Google Fonts & FontAwesome pour les icônes -->
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&display=swap" rel="stylesheet">
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    integrity="sha512-ku5dbX0I3+n3hnYW6PxN5eT6Vce9XlhF51b1ZtZBBd4THPZBwgbG6aHn2upSDhb0kmG8K+Ix3GWeB+Dd7iC9cw=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />

  <style>
    /* -------------------------
       RESET & VARIABLES
    ------------------------- */
    * { box-sizing: border-box; margin:0; padding:0; }
    html, body { height:100%; font-family: 'Oswald', sans-serif; background: #f0f2f5; }
    :root {
      --blue: #006aff;
      --gray: #666;
      --light-gray: #eee;
      --white: #fff;
      --border: #ddd;
      --panel-bg: #fff;
      --panel-shadow: rgba(0,0,0,0.1);
      --heading: #222;
      --text: #444;
    }

    /* -------------------------
       LAYOUT PRINCIPAL
    ------------------------- */
    #root { display:grid; grid-template-rows:auto 1fr; height:100vh; }
    #slider      { background:#000; padding:0.5rem; }
    #slider img  { width:100%; border-radius: 6px; }
    #configurator {
      display:grid;
      grid-template-columns:2fr 1fr;
      gap:1rem;
      padding:1rem;
    }

    /* -------------------------
       VIEWER
    ------------------------- */
    .viewer-card {
      background: var(--panel-bg);
      border-radius:8px;
      box-shadow:0 4px 12px var(--panel-shadow);
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    model-viewer {
      width:100%;
      height:100%;
      background: #fafafa;
    }

    /* -------------------------
       PANNEAU DE CONFIGURATION
    ------------------------- */
    .controls {
      background: var(--panel-bg);
      border-radius:8px;
      box-shadow:0 4px 12px var(--panel-shadow);
      padding:1.5rem;
      overflow-y:auto;
    }
    .controls h2 {
      font-size:1.5rem;
      margin-bottom:1rem;
      color: var(--heading);
    }
    .group {
      margin-bottom:2rem;
    }
    .group h3 {
      font-size:1.1rem;
      margin-bottom:0.75rem;
      color: var(--text);
    }
    .options {
      display:flex;
      gap:1rem;
      flex-wrap:wrap;
    }
    .option {
      text-align:center;
      width:80px;
    }
    .swatch {
      width:100%;
      aspect-ratio:1;
      background: var(--light-gray);
      border:2px solid var(--border);
      border-radius:6px;
      position:relative;
      cursor:pointer;
      transition:border-color .2s;
    }
    .swatch:hover {
      border-color:#aaa;
    }
    .swatch.selected {
      border-color: var(--blue);
    }
    .swatch.selected::after {
      content:'✔';
      position:absolute;
      top:4px; right:6px;
      color: var(--blue);
      font-size:1rem;
    }
    .option-label {
      margin-top:0.5rem;
      font-size:0.85rem;
      color: var(--text);
    }
    .option-price {
      margin-top:0.25rem;
      font-size:0.8rem;
      color: var(--gray);
    }

    /* -------------------------
       BANDEAU DIMENSIONS
    ------------------------- */
    #stats {
      display:flex;
      justify-content:center;
      gap:2rem;
      margin:1rem 0;
    }
    .stat {
      text-align:center;
      color: var(--text);
    }
    .stat i {
      font-size:1.6rem;
      color: var(--blue);
    }
    .stat .value {
      display:block;
      font-size:1.1rem;
      margin-top:0.25rem;
      color: var(--heading);
    }
    .stat .label {
      font-size:0.75rem;
    }

    /* -------------------------
       RÉCAPITULATIF DE PRIX
    ------------------------- */
    #summary {
      background: var(--panel-bg);
      border-radius:8px;
      box-shadow:0 4px 12px var(--panel-shadow);
      padding:1.5rem;
      margin-top:1rem;
    }
    #summary h3 {
      font-size:1.3rem;
      margin-bottom:1rem;
      color: var(--heading);
    }
    .line {
      display:flex;
      justify-content:space-between;
      margin:0.5rem 0;
      font-size:1rem;
      color: var(--text);
    }
    .line.total {
      font-weight:700;
      color: var(--heading);
      margin-top:1rem;
    }

  </style>
</head>
<body>

  <!-- ===== SLIDER D'IMAGES ===== -->
  <div id="slider">
    <!-- Intégrez ici vos 3 miniatures, avec un plugin ou manuellement -->
    <img src="slide1.jpg" alt="Vue 1">
  </div>

  <div id="root">
    <!-- ===== CONFIGURATOR ===== -->
    <div id="configurator">

      <!-- 3D VIEWER -->
      <div class="viewer-card">
        <model-viewer
          id="mv"
          src="TRADIHOME4.glb"
          alt="Maison Tradi'home"
          camera-controls
          exposure="0.35"
          shadow-intensity="0.8"
          shadow-softness="0.3"
          environment-image="neutral"
          loading="eager"
          min-pixel-ratio="2"
          max-pixel-ratio="2"
        ></model-viewer>
      </div>

      <!-- PANEL CONTROLS -->
      <div class="controls">
        <h2>Configuration Tradi’home P4</h2>

        <!-- 1. Bardage -->
        <div class="group" data-cat="Bardage">
          <h3>Bardage extérieur</h3>
          <div class="options">
            <div class="option">
              <div class="swatch" data-color="#C19A6B" data-cost="520"></div>
              <div class="option-label">Chêne clair</div>
              <div class="option-price">+520 €</div>
            </div>
            <div class="option">
              <div class="swatch" data-color="#8B5A2B" data-cost="790"></div>
              <div class="option-label">Chêne foncé</div>
              <div class="option-price">+790 €</div>
            </div>
            <div class="option">
              <div class="swatch" data-color="#3D4C5C" data-cost="895"></div>
              <div class="option-label">Gris oragé</div>
              <div class="option-price">+895 €</div>
            </div>
          </div>
        </div>

        <!-- 2. Menuiserie -->
        <div class="group" data-cat="Menuiserie">
          <h3>Menuiserie ALU</h3>
          <div class="options">
            <div class="option">
              <div class="swatch" data-color="#FFFFFF" data-cost="0"></div>
              <div class="option-label">Blanc</div>
              <div class="option-price">Inclus</div>
            </div>
            <div class="option">
              <div class="swatch" data-color="#293133" data-cost="1480"></div>
              <div class="option-label">Anthracite</div>
              <div class="option-price">+1 480 €</div>
            </div>
          </div>
        </div>

        <!-- 3. Gouttière -->
        <div class="group" data-cat="Gouttiere">
          <h3>Gouttière et descente</h3>
          <div class="options">
            <div class="option">
              <div class="swatch" data-color="#FFFFFF" data-cost="0"></div>
              <div class="option-label">Blanc</div>
              <div class="option-price">Inclus</div>
            </div>
          </div>
        </div>

        <!-- 4. Pergola -->
        <div class="group" data-cat="Pergola">
          <h3>Pergola bioclimatique</h3>
          <div class="options">
            <div class="option">
              <div class="swatch" data-color="#FFFFFF" data-cost="3500"></div>
              <div class="option-label">Blanc</div>
              <div class="option-price">+3 500 €</div>
            </div>
            <div class="option">
              <div class="swatch" data-color="#293133" data-cost="3500"></div>
              <div class="option-label">Anthracite</div>
              <div class="option-price">+3 500 €</div>
            </div>
          </div>
        </div>

        <!-- 5. Peinture -->
        <div class="group" data-cat="Murs">
          <h3>Peinture (mur extérieur)</h3>
          <div class="options">
            <div class="option">
              <div class="swatch" data-color="#FFFFFF" data-cost="0"></div>
              <div class="option-label">Blanc</div>
              <div class="option-price">Inclus</div>
            </div>
            <div class="option">
              <div class="swatch" data-color="#CCC0AF" data-cost="399"></div>
              <div class="option-label">Beige Ares</div>
              <div class="option-price">+399 €</div>
            </div>
            <div class="option">
              <div class="swatch" data-color="#E6C7B1" data-cost="1499"></div>
              <div class="option-label">Ocre Mojave</div>
              <div class="option-price">+1 499 €</div>
            </div>
          </div>
        </div>

        <!-- 6. Toiture -->
        <div class="group" data-cat="Toit">
          <h3>Tôle ondulée</h3>
          <div class="options">
            <div class="option">
              <div class="swatch" data-color="#133654" data-cost="0"></div>
              <div class="option-label">Bleu Ardoise</div>
              <div class="option-price">Inclus</div>
            </div>
            <div class="option">
              <div class="swatch" data-color="#777777" data-cost="0"></div>
              <div class="option-label">Gris Acier</div>
              <div class="option-price">Inclus</div>
            </div>
            <div class="option">
              <div class="swatch" data-color="#CC3333" data-cost="1500"></div>
              <div class="option-label">Rouge Hibiscus</div>
              <div class="option-price">+1 500 €</div>
            </div>
          </div>
        </div>

        <!-- PRIX TOTAL -->
        <div id="price-box">
          Prix total : <span id="price">170 000 €</span>
        </div>
      </div>

    </div>

    <!-- ===== BANDEAU DIMENSIONS ===== -->
    <div id="stats">
      <div class="stat">
        <i class="fa-solid fa-vector-square"></i>
        <span class="value">85 m²</span>
        <span class="label">Surface</span>
      </div>
      <div class="stat">
        <i class="fa-solid fa-bed"></i>
        <span class="value">3 Ch</span>
        <span class="label">Chambres</span>
      </div>
      <div class="stat">
        <i class="fa-solid fa-shower"></i>
        <span class="value">2 SdE</span>
        <span class="label">Salles d’eau</span>
      </div>
    </div>

    <!-- ===== RÉCAPITULATIF DE PRIX ===== -->
    <div id="summary">
      <h3>Récapitulatif de prix</h3>
      <div class="line"><span>Prix de base :</span><span>170 000 €</span></div>
      <div class="line"><span>Options :</span><span id="options-total">0 €</span></div>
      <div class="line total"><span>Prix TTC :</span><span id="ttc">170 000 €</span></div>
    </div>

  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const mv      = document.getElementById('mv');
      const base    = 170000;
      const priceEl = document.getElementById('price');
      const optEl   = document.getElementById('options-total');
      const ttcEl   = document.getElementById('ttc');

      const targets = {
        Bardage:   ['poutrine01','poutrine02'],
        Menuiserie:['porte','cadre porte fenetre','volets','encadrement'],
        Gouttiere: ['goutieres'],
        Pergola:   ['poutres','volet pergola'],
        Murs:      ['murs'],
        Toit:      ['toit1','toit contour']
      };

      let sel = {};

      mv.addEventListener('load', () => {
        const mats = mv.model.materials;
        function hex2rgba(h) {
          const v = parseInt(h.slice(1),16);
          return [(v>>16&255)/255,(v>>8&255)/255,(v&255)/255,1];
        }

        document.querySelectorAll('.group').forEach(group => {
          const cat = group.dataset.cat;
          const frags = targets[cat] || [];

          group.querySelectorAll('.swatch').forEach(btn => {
            btn.addEventListener('click', () => {
              // UI
              group.querySelectorAll('.swatch').forEach(b=>b.classList.remove('selected'));
              btn.classList.add('selected');

              // Prix
              sel[cat] = +btn.dataset.cost;
              const opts = Object.values(sel).reduce((a,b)=>a+b,0);
              const tot  = base + opts;
              priceEl.textContent = tot.toLocaleString('fr-FR') + ' €';
              optEl.textContent   = opts.toLocaleString('fr-FR') + ' €';
              ttcEl.textContent   = tot.toLocaleString('fr-FR') + ' €';

              // Couleur
              const rgba = hex2rgba(btn.dataset.color);
              mats.forEach(m=>{
                const n = m.name.toLowerCase();
                if (frags.some(f=>n.includes(f))) {
                  m.pbrMetallicRoughness.setBaseColorFactor(rgba);
                }
              });
            });
          });

          // sélection par défaut
          const first = group.querySelector('.swatch');
          if(first) first.click();
        });
      });
    });
  </script>

</body>
</html>
