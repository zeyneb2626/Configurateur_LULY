<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Configurateur Tradi'home P4</title>
  <script type="module"
          src="https://unpkg.com/@google/model-viewer@1.12.0/dist/model-viewer.min.js">
  </script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; font-family: sans-serif; }
    #container {
      display: flex;
      height: 100vh;
      background: #f5f5f5;
    }
    model-viewer {
      flex: 3;
      width: 100%;
      height: 100%;
      background: #fff;
      /* high-resolution, crisp rendering */
      min-pixel-ratio="2"
      max-pixel-ratio="2"
      camera-controls
      shadow-intensity="0.8"
      shadow-softness="0.3"
      environment-image="neutral"
      exposure="0.4"
      loading="eager"
    }
    #controls {
      flex: 1;
      background: #fafafa;
      padding: 1.5rem;
      border-left: 1px solid #ddd;
      overflow-y: auto;
    }
    h2 {
      margin-bottom: 1rem;
      font-size: 1.5rem;
      color: #333;
    }
    .group {
      margin-bottom: 2rem;
    }
    .group h3 {
      margin-bottom: .75rem;
      font-size: 1.1rem;
      color: #222;
    }
    .swatches {
      display: flex;
      flex-wrap: wrap;
      gap: .5rem;
    }
    .swatch {
      width: 48px;
      height: 48px;
      border: 2px solid #ccc;
      border-radius: 6px;
      cursor: pointer;
      position: relative;
      transition: border-color .2s, transform .1s;
      background-size: cover;
      background-position: center;
    }
    .swatch:hover {
      border-color: #888;
      transform: scale(1.05);
    }
    .swatch.selected {
      border-color: #007aff;
      box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.2);
    }
    .swatch::after {
      content: attr(data-label);
      position: absolute;
      bottom: -1.4rem;
      left: 50%;
      transform: translateX(-50%);
      font-size: .65rem;
      color: #555;
      white-space: nowrap;
    }
    .price-tag {
      position: absolute;
      bottom: -2.9rem;
      left: 50%;
      transform: translateX(-50%);
      font-size: .6rem;
      color: #666;
    }
    #price-box {
      margin-top: 2rem;
      padding: 1rem;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 6px;
      text-align: right;
      font-size: 1.25rem;
      font-weight: bold;
      color: #2c3e50;
    }
  </style>
</head>
<body>
  <div id="container">
    <!-- 3D VIEWER -->
    <model-viewer
      id="mv"
      src="TRADIHOME4.glb"
      alt="Maison Tradi'home P4">
    </model-viewer>

    <!-- CONTROLES -->
    <div id="controls">
      <h2>Personnalisez votre maison</h2>

      <!-- Bardage extérieur -->
      <div class="group" data-cat="Bardage">
        <h3>Bardage extérieur</h3>
        <div class="swatches">
          <div class="swatch" data-cat="Bardage" data-label="Chêne clair" data-color="#C19A6B" data-cost="520"
               style="background-color:#C19A6B;">
            <div class="price-tag">+520 €</div>
          </div>
          <div class="swatch" data-cat="Bardage" data-label="Chêne foncé" data-color="#8B5A2B" data-cost="790"
               style="background-color:#8B5A2B;">
            <div class="price-tag">+790 €</div>
          </div>
          <div class="swatch" data-cat="Bardage" data-label="Gris oragé" data-color="#3D4C5C" data-cost="895"
               style="background-color:#3D4C5C;">
            <div class="price-tag">+895 €</div>
          </div>
        </div>
      </div>

      <!-- Menuiserie ALU -->
      <div class="group" data-cat="Menuiserie">
        <h3>Menuiserie ALU</h3>
        <div class="swatches">
          <div class="swatch" data-cat="Menuiserie" data-label="Blanc" data-color="#FFFFFF" data-cost="0"
               style="background-color:#FFFFFF;">
            <div class="price-tag">Inclus</div>
          </div>
          <div class="swatch" data-cat="Menuiserie" data-label="Anthracite" data-color="#293133" data-cost="1480"
               style="background-color:#293133;">
            <div class="price-tag">+1 480 €</div>
          </div>
        </div>
      </div>

      <!-- Gouttière et descente -->
      <div class="group" data-cat="Gouttiere">
        <h3>Gouttière et descente</h3>
        <div class="swatches">
          <div class="swatch" data-cat="Gouttiere" data-label="Blanc" data-color="#FFFFFF" data-cost="0"
               style="background-color:#FFFFFF;">
            <div class="price-tag">Inclus</div>
          </div>
        </div>
      </div>

      <!-- Pergola bioclimatique -->
      <div class="group" data-cat="Pergola">
        <h3>Pergola bioclimatique</h3>
        <div class="swatches">
          <div class="swatch" data-cat="Pergola" data-label="Blanc" data-color="#FFFFFF" data-cost="3500"
               style="background-color:#FFFFFF;">
            <div class="price-tag">+3 500 €</div>
          </div>
          <div class="swatch" data-cat="Pergola" data-label="Anthracite" data-color="#293133" data-cost="3500"
               style="background-color:#293133;">
            <div class="price-tag">+3 500 €</div>
          </div>
        </div>
      </div>

      <!-- Peinture (mur extérieur) -->
      <div class="group" data-cat="Murs">
        <h3>Peinture (mur extérieur)</h3>
        <div class="swatches">
          <div class="swatch" data-cat="Murs" data-label="Blanc" data-color="#FFFFFF" data-cost="0"
               style="background-color:#FFFFFF;">
            <div class="price-tag">Inclus</div>
          </div>
          <div class="swatch" data-cat="Murs" data-label="Beige Ares" data-color="#CCC0AF" data-cost="399"
               style="background-color:#CCC0AF;">
            <div class="price-tag">+399 €</div>
          </div>
          <div class="swatch" data-cat="Murs" data-label="Ocre Mojave" data-color="#E6C7B1" data-cost="1499"
               style="background-color:#E6C7B1;">
            <div class="price-tag">+1 499 €</div>
          </div>
        </div>
      </div>

      <!-- Tôle ondulée -->
      <div class="group" data-cat="Toit">
        <h3>Tôle ondulée</h3>
        <div class="swatches">
          <div class="swatch" data-cat="Toit" data-label="Bleu Ardoise" data-color="#133654" data-cost="0"
               style="background-color:#133654;">
            <div class="price-tag">Inclus</div>
          </div>
          <div class="swatch" data-cat="Toit" data-label="Gris Acier" data-color="#777777" data-cost="0"
               style="background-color:#777777;">
            <div class="price-tag">Inclus</div>
          </div>
          <div class="swatch" data-cat="Toit" data-label="Rouge Hibiscus" data-color="#CC3333" data-cost="1500"
               style="background-color:#CC3333;">
            <div class="price-tag">+1 500 €</div>
          </div>
        </div>
      </div>

      <div id="price-box">
        Prix total : <span id="price">170 000 €</span>
      </div>
    </div>
  </div>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const mv      = document.getElementById('mv');
      const base    = 170000;
      const priceEl = document.getElementById('price');
      let selection = {};

      // Seuls ces fragments réagissent aux clics ; poutrine02 reste toujours chêne foncé
      const targets = {
        Bardage:    ['poutrine01'],
        Menuiserie: ['porte', 'cadre porte fenetre', 'volets', 'encadrement'],
        Gouttiere:  ['goutieres'],
        Pergola:    ['poutres', 'volet pergola'],
        Murs:       ['murs'],
        Toit:       ['toit1', 'toit contour']
      };

      function hex2rgba(hex) {
        const v = parseInt(hex.slice(1), 16);
        return [(v>>16&255)/255, (v>>8&255)/255, (v&255)/255, 1];
      }

      mv.addEventListener('load', () => {
        const mats = mv.model.materials;

        // Fixer d'emblée poutrine02 en chêne foncé
        const darkWood = hex2rgba('#8B5A2B');
        mats.forEach(m => {
          if ( m.name.toLowerCase().includes('poutrine02') ) {
            m.pbrMetallicRoughness.setBaseColorFactor(darkWood);
          }
        });

        // Brancher tous les groupes de boutons
        document.querySelectorAll('.group').forEach(group => {
          const cat   = group.dataset.cat;
          const frags = targets[cat] || [];

          group.querySelectorAll('.swatch').forEach(btn => {
            btn.addEventListener('click', () => {
              // UI
              group.querySelectorAll('.swatch')
                   .forEach(el => el.classList.remove('selected'));
              btn.classList.add('selected');

              // Mise à jour prix
              selection[cat] = Number(btn.dataset.cost);
              const total = Object.values(selection).reduce((a,b)=>a+b, base);
              priceEl.textContent = total.toLocaleString('fr-FR') + ' €';

              // Appliquer nouvelle couleur
              const rgba = hex2rgba(btn.dataset.color);
              mats.forEach(m => {
                const name = m.name.toLowerCase();
                if (frags.some(f => name.includes(f))) {
                  m.pbrMetallicRoughness.setBaseColorFactor(rgba);
                }
              });
            });
          });

          // Sélection par défaut du premier bouton
          const first = group.querySelector('.swatch');
          if (first) first.click();
        });
      });
    });
  </script>
</body>
</html>

